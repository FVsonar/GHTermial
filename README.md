# GHTerminal - Qt串口终端工具

## 项目简介

GHTerminal是一个基于Qt框架开发的串口通信终端工具，专门用于与Q900系列电台进行通信和配置。该工具提供了友好的图形用户界面，支持多语言，并实现了完整的串口通信协议。

## 功能特性

### 🔧 核心功能
- **串口通信**: 支持串口连接和通信
- **信道管理**: 读取和写入电台信道配置
- **DMR配置**: 支持DMR模式的参数配置
- **多语言支持**: 支持中文、英文、法文、德文等多种语言
- **数据导入导出**: 支持JSON格式的数据导入导出

### 📊 界面特性
- **现代化UI**: 基于Qt Widgets的现代化用户界面
- **表格视图**: 直观的信道数据表格显示
- **实时状态**: 实时显示连接状态和通信进度
- **自定义委托**: 支持复选框、下拉框、数字输入等多种控件

### 🔄 通信协议
- **Q900协议**: 完整实现Q900系列电台通信协议
- **命令支持**: 支持0x40、0x41、0x43、0x44等命令
- **重试机制**: 自动重试失败的通信命令
- **CRC校验**: 完整的数据校验机制

## 技术架构

### 🏗️ 项目结构
```
GHTerminal_673/
├── Controller/          # 控制器层
├── DAO/                # 数据访问层
├── Delegates/          # 表格委托
├── Entity/             # 实体类
├── Service/            # 业务逻辑层
├── Tools/              # 工具类
├── View/               # 视图层
├── img/                # 图片资源
├── language/           # 语言文件
└── src/                # 源代码
```

### 🛠️ 技术栈
- **Qt 5.15.2**: 跨平台GUI框架
- **C++**: 主要开发语言
- **QSerialPort**: 串口通信
- **QStandardItemModel**: 数据模型
- **QStyledItemDelegate**: 自定义委托

## 编译要求

### 系统要求
- Windows 10/11
- Qt 5.15.2 或更高版本
- MinGW 编译器

### 依赖库
- Qt Core
- Qt Widgets
- Qt SerialPort
- Qt Network

## 编译步骤

1. **克隆项目**
   ```bash
   git clone https://github.com/your-username/GHTerminal.git
   cd GHTerminal
   ```

2. **配置Qt环境**
   - 安装Qt 5.15.2
   - 配置MinGW编译器

3. **编译项目**
   ```bash
   qmake GHTerminal_673.pro
   make
   ```

4. **运行程序**
   ```bash
   ./GHTerminal_673.exe
   ```

## 使用说明

### 基本操作
1. **连接设备**: 选择串口并点击连接按钮
2. **读取数据**: 点击读取按钮获取电台配置
3. **修改配置**: 在表格中直接编辑参数
4. **保存配置**: 点击发送按钮将配置写入电台
5. **导入导出**: 使用JSON格式导入导出配置

### 界面说明
- **串口设置**: 配置串口参数
- **信道表格**: 显示和编辑信道参数
- **进度条**: 显示操作进度
- **状态栏**: 显示当前状态信息

## 协议文档

详细的Q900控制协议请参考项目中的 `Q900控制协议.md` 文件。

## 贡献指南

欢迎提交Issue和Pull Request来改进这个项目。

### 开发规范
- 遵循Qt编码规范
- 使用中文注释
- 保持代码整洁

## 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 更新日志

### v1.0.0
- 初始版本发布
- 支持基本的串口通信功能
- 实现Q900协议
- 添加多语言支持

## 联系方式

如有问题或建议，请通过以下方式联系：
- 提交GitHub Issue
- 发送邮件至项目维护者

---

**注意**: 本工具仅用于合法的无线电通信配置，请遵守当地法律法规。

# 项目

项目名

> 国赫 T7

项目路径

> E:\QTproject\GHTermial_673

开发工具

> 桌面 -> Qt 6.7

# 版本

开发工具版本

> Qt 6.7.3

编译工具

> Qt 6.7.3 mingw64

打包命令

> 注： 每次打包都要切换到release 并复制最新的exe文件
1. 工程切换至release模式  

2.在下面文件夹中复制exe文件
E:\CODE\2_Code\X-Terminal\GHTerminal\build-GHTermial-Desktop_Qt_5_15_2_MinGW_64_bit-Release\release

3. 将复制的exe文件放到下面目录

4. 打开命令行工具 执行一下命令
    1. C:
    2. 手动输入cd 
    3. 复制目录 C:\Users\WD\Desktop\GHTerminal
    4. 右键粘贴
    3. windeployqt  --qmldir E:\CODE\2_Code\X-Terminal\GHTerminal\GHTermial\assets\qml QSerialTerminal.exe

5. 启动程序Inno Setup Compiler
没有就下一个，跟着操作到最后就可以将程序打包为安装包


## 参数

### 协议中pmr171 DMR实际有用的参数

#### AB频切换

##### A_B

* 0：A频
* 1：B频
* 2：A=B频

#### 异频

##### SPLIT

* 0：异频关
* 1：异频开

#### 正常信道部分

##### VFA_MODE	频率A

UV段的主要频率，如果不走中继，只设置这个就可以

##### VFB_MODE	频率B

##### T_CTCSS	发送亚音

用中继的情况下需要设置亚音

作用：当某个判断上有很多人沟通时，只想跟某人建立沟通可以相互设置亚音，这样其他不是同一个亚音的音频会被设备静音，相同的则会正常

##### R_CTCSS	接收亚音

同上

#### DMR

##### call_type：呼叫类型 (call_Format)

* sigle 单呼
* group 组呼
* all 全呼

##### tx_cc：发射色码

跟亚音功能一样

##### rx_cc：接收色码

跟亚音功能一样

##### slot：时隙

* 0 双时隙
* 1 时隙1
* 2 时隙2

可以看成时间片，把一个频率分为两个频率，时隙1就是用前时隙，时隙2就是用后时隙，两个时隙互不干扰。双时隙就是同时使用两个时隙

##### call_id：呼叫的ID

呼叫对象的ID，接入键盘输入，英文+数字

##### own_id：本机ID

同上

##### ch_type：信号类型

* DMR 数字语音模式
* DFM 模拟FM模式

DFM模式下的时候才会用到DMR设置的亚音

##### rx_ctcss：接收亚音

DMR部分的亚音，只有DFM混合模式才生效

##### tx_ctcss：发射亚音

同上

##### rxgain：接收中频增益 推荐值3

没有对应命令

##### SQL：接收静噪（sqlevel）

目前固定无法修改

##### encry：加密使能

不显示，pmr171不支持

##### seed：加密密钥

不显示，pmr171不支持

## 文件结构

### Entity

存放了xx协议对象,比如协议中0x44对应的读写数据包

### DAO

本来是打算封装TCP/串口读写的,但哥们没时间,就写成了将返回数据转化为Entity对象的工具

### Server

处理将要发送的数据,将对象转化为发送的数据包格式

### Tools

都是一些共用的函数,比如tools的CRC16循环冗余校验

### View

这是我最后一次重构时打算解耦的东西,尝试将各个标签页从termial中分离,没弄完,没时间,没水平

# TODO

* [X] 编程页
* [X] 天调页
* [X] 合并TCP和串口读取/发送
* [X] 读取/发送中再次点击读取/发送立即终止
* [X] 优化"编程页"速度
* [X] 修复JSON部分
* [ ] 可快速复制粘贴
* [X] 界面美化
* [X] 减少卡顿
* [X] 进度条bug修复

# 更新日记

### 2025/04/26

1. 重写UI
2. 删除TCP/UDP
3.

### 2025/04/21

1. 新增启动配置界面
2. 将右侧配置栏整合到启动界面

### 2024/11/17

1. 弧度表实现太麻烦,改为刻度计
2. 修复切换页面导致的定时器多开
3. 修复电压校准值不生效
4. 修复国际化错误

### 2024/11/16

1. 绑定新UI的逻辑
2. 修复同步不及时
3. 修改同步速度为500ms
4. 修复切换调谐模式时自动发送命令
5. 修复电压显示错误
6. 正向功率校准值/主播校准值/电压校准值增加刻度显示
7. 正向功率校准值/主播校准值/电压校准值/驻波调谐值增加鼠标滚轮控制
8. 在自动调谐时不再等待回复,防止阻塞控制手动/关闭调谐

* [ ] 驻波调谐值的显示UI改为弧度表

### 2024/11/15

1. 大改天调页UI
2. 不再重发读取不到的数据以提升整体速度,用户可再次点击读取来获得
3. 数据本体管理改为Entity层
4. 管理以何种方式存入Entity层为DAO层
5. 操作数据为Service层

#### 问题

1. 驻波下不去,唐毅在弄

### 2024/11/14

1. 添加一个定时同步按钮,让用户自己选择
2. 重写数据接收逻辑,兼容数据分段到达的情况
3. 重写编程页部分逻辑,兼容天调部分
4. 修复进度条乱显示
5. 添加未连接时操作的提醒弹框
6. 添加了一个主页防止编程页UI渲染时间过长阻塞程序启动
7. 添加了最小化时的防假死机制

### 2024/11/13

1. 合并TCP与串口发送逻辑
2. 再次点击按钮可终止继续发送/读取
3. 使UI随界面大小变化
4. 完成天调方面代码

#### 问题

* [X] 数据有分段回复情况,重写接收逻辑

### 2024/11/12

1. [X] 天调调谐指令 接收
2. [X] 天调调谐指令 发送
3. [X] 天调状态同步指令 接收
4. [X] 天调状态同步指令 发送
5. [X] 天调状态同步指令 定时刷新
6. [X] 天调校准指令 接收
7. [X] 天调校准指令 发送

#### 暂定UI

![1731405232614](image/GHT迭代/1731405232614.png)

### 2024/11/11

1. 增加"页"
   1. 编程
   2. 设置
   3. 工程模式
   4. 天调
2. 项目已转型为MVC架构
3. 添加天调页UI
4. 添加天调实体对象
5. 添加天调view显示对象
6. 优化切换到编程页的时间 (其他页秒开
7. 优化在非编程页下的一切UI操作时间
8. 对程序大量解耦 , 利于后续开发
9. 修改程序名

#### 概念图

![1731318963216](image/GHT迭代/1731318963216.png)

## v1

### 2024/11/09

1. 修复进度条显示

### 2024/11/08

1. 使UI适配任意大于400px高 350px宽的屏幕
2. 使操作区域恒定于窗口右侧
3. 添加程序图标
4. 切换语言改为异步执行
5. 修复程序不稳定
6. 修复串口断开后电台处于发射状态

#### 问题

1. 进度条显示有bug

   > 加入dmr后原来设计的算法无法兼容,要重写
   >

### 2024/11/07

1. 印地语
2. 修复大量bug
3. 串口的热插拔实现太复杂,资源消耗也大,换成刷新按钮
4. 对大部分阻塞操作加了进度条显示
5. TCP优化了41 44的速度 , 40 43没什么效果
6. 修改属性以对应电台
   > 王冬说以电台为准
   >

#### 问题

* [ ] 切屏回程序卡顿

### 2024/11/06

1. 保存json添加dmr
2. 打开json添加dmr
3. 适配国际化
4. 修复下拉框数据异常
5. 修复乱码
6. 可动态刷新语言
7. 修复json数据异常

#### 国际化

* [X] 英语
* [X] 中文
* [X] 德语
* [X] 法语
* [X] 俄语
* [X] 日语
* [X] 阿拉伯语
* [X] 西班牙语
* [X] 葡萄牙语
* [X] 印语

#### 问题

1. 王哥还没改 , 暂时没法做压力测试
2. 有明显卡顿感

### 2024/11/05

1. 解决了启动速度慢

   > 从 3分钟启动 优化到 400毫秒内启动
   > 代价是略微降低读取后更新UI的速度,每条大概降低5~10ms
   > 全选读取时最后几条可能浮动到接近800ms
   > 猜测因为容器选择的是List,list的查询速度并不快,而程序有17个池,在查询末尾数据时非常慢
   > 这点后面有时间再优化吧,目前已经可以满足日常使用
   >
2. 修改了算法以解决粘包问题
3. 解决了串口和TCP速度慢的问题

#### 问题

* [X] 44数据返回信道的是单字节
* [X] 目前国际化只添加了英语,在切换时动态刷新期间有可能文本出现乱码
* [ ] 1000条channel+dmr的表单大概有2万4千个单元格对象,从后台切回程序时会有1~2秒的卡顿

### 2024/11/04

1. 串口完成
2. TCP完成

#### 问题

* [X] 串口和TCP的速度又慢下来了
* [X] 粘包很严重,加上DMR后算法需要改

### 2024/11/01

1. TCP方面只差一个DMR超时重传机制
2. 串口方面还差DMR修改和DMR超时重传
3. 主要查bug

#### 问题

1. 给电台发送40写命令后 , 电台成功被修改 , 再次读取却是未修改状态
2. 给电台发送43写命令后 , 电台回复数据缺少crc , 电台回复成功但实际并不一定
   1. 还有可能不止缺少crc , 只是缺少crc的回复最频繁
3. 串口读取回复的数据中有乱码
4. 电台物理修改频率后 , 通过41命令读取实际并不一定读取到电台显示数据
5. 电台DMR中的RX-CRCSS数据有问题 , 显示中有63.0Hz , 协议中没有
6. 电台DMR中的CALL_ID在CALL_TYPPE为ALL时显示为16777215 , 使用44读命令读取为0
7. 电台DMR中的CH_TYPE显示为DFM , 44读命令读取为DMR

### 2024/10/31

1. 添加DMR对象
2. 显示DMR
3. TCP读发DMR
4. TCP修改DMR

#### 问题

1. 加上DMR后程序速度巨慢
2. 程序变得不稳定,时常卡顿
3. 写信道成功(电台回复成功) , 但电台实际没有成功 , 再次读取也还是原来的值

#### 备注

把架构从MVC改回来了 , 不够稳定 , 优化需要大量时间
优先完成核心功能 , 后续有空再重构/优化代码

### 2024/10/24

1. 将TCP读取速度**极大幅度提升** , 从45秒提升到**5秒以内**读完
2. 将TCP发送速度**极大幅度提升** , 从45秒提升到**5秒以内**发完
3. 解决全选/全不选可能导致的程序崩溃问题
4. 解决大批量发送读写导致的卡死
5. 优化程序整体稳定性

### 2024/10/21

1. 修复进度条显示百分比异常
2. 优化UI
   * 将进度条从百分比显示改为真正的进度条
   * 将表格数据居中对齐
   * 将单元格大小与数据宽度绑定
   * 更改整体布局
   * 将复选框改至第一列

### 2024/10/19

1. 心跳包防止客户端断联
2. TCP方面逻辑基本完成

   > TCP的速度相对串口速度更慢,更不稳定,超时重发所需时间更久
   >

#### 问题

1. 程序不够稳定,偶尔会异常退出,大概率是哪儿的数据溢出
2. 大批量发送读写请求,电台会卡死

### 2024/10/18

1. 串口方面读取速度大幅提升
   > 从原1000条读取75秒到现在45秒,继续优化也只能优化一两秒,而时间成本会增加,暂时搁置这方面优化
   >
2. 完善TCP UI
3. 完善TCP发送逻辑
4. 完善TCP接收逻辑
5. 增加TCP一对多逻辑

### 2024/10/17

1. 整体读写速度显著改善 原读1000条需要1份15秒左右,现在稳定在45秒左右,快了半分钟
2. 信道名显示优化
3. 限制频率最大值
4. 全选速度提升至不到1秒

* 全不选按钮速度慢

> 不是遍历导致的速度慢,而是"取消勾选"这本身是个耗时操作,此操作是Qt框架底层设计
> 多线程无用是因为其"取消勾选"要更改UI,更改UI就要回到主线程,所以此处使用多线程没有意义

### 2024/10/16

1. 有一个全选按钮，再次点击全不选
   > 反转状态会多次触发改变函数导致程序卡死，待解决
   >
2. 行输入框，输入信道号按下回车跳转至对应预留位置
3. 加一个定时器，扫描串口，扫描到了设备自动连接
4. 保存为json
5. 读取json

### 2024/10/15

1. 大改程序架构以适配勾选框
2. 勾选，选择读取，选择发送
3. 若未勾选，哪怕有更改，点了发送也不发送数据
4. 初始化表格时提前预留1000个位置让用户选择读取
5. 可重复读取
6. 可重复发送

* 预留位置，导致程序初始化速度变慢
